<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MetroPet Chat Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and dependencies -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { motion } = window['framer-motion'];

    const Card = ({ className = '', children }) => (
      <div className={`bg-white border shadow rounded-lg ${className}`}>{children}</div>
    );
    const CardContent = ({ className = '', children }) => (
      <div className={`p-4 ${className}`}>{children}</div>
    );
    const Button = ({ className = '', children, ...props }) => (
      <button className={`px-3 py-2 bg-indigo-600 text-white rounded ${className}`} {...props}>{children}</button>
    );
    const Input = (props) => (
      <input className="border rounded px-3 py-2 w-full" {...props} />
    );
    const SendIcon = () => React.createElement('span', {className:'inline-block'}, window.lucide.Send.createSVG());

    const ChatUI = () => {
      const [messages, setMessages] = React.useState([
        { role: 'assistant', content: '嗨！我是捷米，今天要去哪裡呢？' },
      ]);
      const [input, setInput] = React.useState('');
      const bottomRef = React.useRef(null);

      const handleSend = () => {
        if (!input.trim()) return;
        const userMessage = { role: 'user', content: input.trim() };
        setMessages(prev => [...prev, userMessage]);
        setInput('');
        // mock reply
        setTimeout(() => {
          const assistantMessage = {
            role: 'assistant',
            content: '這是示範回覆，後端串接完成後會改為真實回答。',
          };
          setMessages(prev => [...prev, assistantMessage]);
        }, 500);
      };

      const handleKeyDown = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      };

      React.useEffect(() => {
        bottomRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      const bubbleStyle = 'max-w-[70%] p-3 rounded-2xl shadow-sm whitespace-pre-line leading-relaxed';

      return (
        <div className="min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-fuchsia-100 flex items-center justify-center p-4">
          <Card className="w-full max-w-2xl h-[80vh] flex flex-col">
            <CardContent className="flex-1 overflow-y-auto space-y-3">
              {messages.map((m, idx) => (
                <motion.div key={idx} initial={{opacity:0,y:10}} animate={{opacity:1,y:0}} transition={{duration:0.2}}
                  className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}> 
                  <div className={`${bubbleStyle} ${m.role === 'user' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-800'}`}>{m.content}</div>
                </motion.div>
              ))}
              <div ref={bottomRef} />
            </CardContent>
            <div className="p-4 border-t flex gap-2">
              <Input placeholder="輸入訊息…" value={input} onChange={e => setInput(e.target.value)} onKeyDown={handleKeyDown} />
              <Button onClick={handleSend} className="shrink-0" title="Send"><SendIcon/></Button>
            </div>
          </Card>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<ChatUI />);
  </script>
</body>
</html>
